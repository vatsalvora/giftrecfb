<html>
<head>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <title>jQuery Example</title>
    <script>
      $(document).ready(function() {
        $.ajaxSetup({ cache: true });
		  $.getScript('//connect.facebook.net/en_UK/all.js', function(){
			FB.init({
			  appId: '799066233444105',
			});
			FB.login(function(){}, {scope: 'user_likes,user_friends,friends_likes'});			
			$('#loginbutton').removeAttr('disabled');
			FB.getLoginStatus(updateStatusCallback);
		  });
		 
      });
	  function updateStatusCallback(){
		// Your logic here
		 console.log('Welcome!  Fetching your information.... ');
		//var friendName = prompt("Name of Friend?").toLowerCase();
		var getIDS = function(list){
			for(var l in list)
			{
				$.getJSON('http://www.omdbapi.com/?t=' + l, function(json_data){
					if(json_data.Response === "True")
					{
						$('#cat').append("<li>" + json_data.imdbID + "</li>");
						var imdbID = json_data.imdbID.substr(2);
						/*
						$.getJSON("https://api-test.filmaster.tv/rest/1.0/film/" + imdbID +"/similar/?&callback=?", null,
						function(data){console.log(JSON.stringify(data));});
						$.ajax({
						type: "GET",
						//crossDomain: true,
						username: "test_imdb",
						password: "test",
						url: "https://api-test.filmaster.tv/rest/1.0/film/" + imdbID +"/similar/?&callback=?",
						dataType: "jsonp",
						success: function(data){
								console.log(JSON.stringify(data));
						}
						});
						*/
					}
				});
			}
		}
		var getLikes = function(id,name,list){
			FB.api('/'+id+'/likes', function(response){
				console.log(response);
				var category = prompt("What Category do you want to Compare? (movie or tv show)").toLowerCase();
				var usercat = {};
				var fricat = {};
				var likePool = {};
				for(var j=0; j<list.length; j++)
				{
					$('#userlikes').append("<li>"+ list[j]["name"] + "</li>");
					if(list[j]["category"].toLowerCase()===category)
					{
						usercat[list[j]["name"]] = true;
						likePool[list[j]["name"]] = true;
					}
				}
				$('#friendlikes').append("<h4>"+ name + "</h4>");
				for(var k=0; k<response.data.length; k++)
				{
					$('#friendlikes').append("<li>"+ response.data[k]["name"] + "</li>");
					if(response.data[k]["category"].toLowerCase()===category)
					{
						fricat[response.data[k]["name"]] = true;
						likePool[response.data[k]["name"]] = true;
					}
				}
				console.log(usercat);
				console.log(fricat);
				for(var l in fricat)
				{
					if(!(l in usercat))
					{
						$('#cat').append("<li>"+ l + "</li>");
					}
				}
				getIDS(likePool);
			});
		}
		function getProfileImage(id,name) {
		 
			var $photo = $('.photo'),
				$fbPhoto = $('img.fb-photo');
		 
		 
			FB.api("/"+id+"/picture?width=90&height=90",  function(response) {
		 
				var profileImage = response.data.url.split('https://')[1], //remove https to avoid any cert issues
					randomNumber = Math.floor(Math.random()*256);
		 
			   //remove if there and add image element to dom to show without refresh
			   if( $fbPhoto.length ){
				   $fbPhoto.remove();
			   }
				 //add random number to reduce the frequency of cached images showing
				//console.log(name);
				var nameArray = name.split(" ");
				var nameCombined = nameArray[0]+"-"+nameArray[1];
			   $photo.append('<img id='+id+' class='+ nameCombined +' src="https://' + profileImage + '?' + randomNumber + '">');
			   $photo.append("<p>"+name+"</p>");
	
			   $( '#'+id ).bind('click',function() {
					//$(this).css('color', 'blue');
					var fName = $(this).attr('class').split("-");
					fName = fName[0]+" "+fName[1];
					$('#userlikes').empty();
					$('#userlikes').append("<h3>User Likes!!!</h3>");
					$('#friendlikes').empty();
					$('#friendlikes').append("<h3>Friend Likes!!!</h3>");
					$('#cat').empty();
					$('#cat').append("<h3>Suggestions!!</h3>");
					$('#imp').empty();
					$('#imp').append("<h3>Selected Information!!!</h3>");
					console.log(fName);
					console.log(this.id);
					suggest(fName, this.id);
				});
			}); 
		}
		function getFriends()
		{
			FB.api(
				'/me/friends',
				function (response) {
				  if (response && !response.error) {
					console.log(response.data[0]["name"]);
					for(var i=0; i<response.data.length; i++)
					{
						var name = response.data[i]["name"];
						var id = response.data[i]["id"];
						getProfileImage(id,name);
					}
				  }
				  });
		}
		function suggest(friendName, id)
		{
			FB.api('/me/likes',function(response){
				if (response && !response.error) {
					$('#imp').append("<h4>" + friendName + "</h4>");
					getLikes(id,friendName,response.data);
					console.log(response);
				}
			});
		}
		 getFriends();
		 console.log("Done!");
	}
    </script>
</head>
<body>
<div id="fb-root"></div>
<h3>Under Development!!!</h3>
<div id="imp">
<h3>Selected Information!!!</h3>
</div>
<div id = "cat">
<h3>Suggestions!!</h3>
</div>
<div id ="friendlikes">
<h3>Friend Likes!!!</h3>
</div>
<div id ="userlikes">
<h3>User Likes!!!</h3>
</div>
<div id="disp" class="photo">
<h3>Complete Information!!!</h3>
</div>
<br>
</body>
</html>